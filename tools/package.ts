import luamin from 'https://esm.sh/luamin'

const dirs = ['./out']
const LicenseDir = './LICENSE'

const License = Deno.readTextFileSync(LicenseDir)

function Directory(Dir: string) {
	for (const dirEntry of Deno.readDirSync(Dir)) {
		const dirEntryFullName = Dir + '/' + dirEntry.name

		if (dirEntry.isDirectory === true) {
			Directory(dirEntryFullName)
		} else {
			if (dirEntry.name.split('.')[1] === 'lua') {
				console.log(`Minifying ${dirEntry.name}...`)
				const minified = luamin.minify(Deno.readTextFileSync(dirEntryFullName))
				Deno.writeTextFile(dirEntryFullName, `--[[\n${License}--]]\n${minified}`)
			}
		}
	}
}

dirs.forEach((dir) => Directory(dir))
